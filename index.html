<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>·ª®ng D·ª•ng Ch·∫•m C√¥ng Offline Pro</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Toast Notification System */
        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            min-width: 300px;
            max-width: 400px;
            background: #28a745;
            color: white;
            padding: 16px 20px;
            border-radius: 12px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.2);
            z-index: 1000;
            transform: translateX(450px);
            transition: all 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            display: flex;
            align-items: center;
            gap: 12px;
            font-weight: 500;
            border-left: 4px solid rgba(255,255,255,0.3);
        }

        .toast.show {
            transform: translateX(0);
        }

        .toast.success {
            background: linear-gradient(135deg, #28a745, #20c997);
        }

        .toast.error {
            background: linear-gradient(135deg, #dc3545, #e74c3c);
        }

        .toast.warning {
            background: linear-gradient(135deg, #ffc107, #f39c12);
            color: #333;
        }

        .toast-icon {
            font-size: 20px;
            flex-shrink: 0;
        }

        .toast-content {
            flex: 1;
        }

        .toast-close {
            background: none;
            border: none;
            color: inherit;
            font-size: 18px;
            cursor: pointer;
            padding: 4px;
            border-radius: 4px;
            opacity: 0.7;
            transition: opacity 0.2s;
            flex-shrink: 0;
        }

        .toast-close:hover {
            opacity: 1;
            background: rgba(255,255,255,0.1);
        }

        /* Login View Styles */
        #loginView {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }

        .login-card {
            background: white;
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.2);
            width: 100%;
            max-width: 400px;
        }

        .login-card h1 {
            text-align: center;
            margin-bottom: 30px;
            color: #667eea;
            font-size: 28px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #555;
        }

        input[type="text"], input[type="password"], input[type="number"], 
        input[type="date"], input[type="time"], input[type="datetime-local"], 
        select, textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        textarea {
            resize: vertical;
            min-height: 80px;
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            width: 100%;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-small {
            padding: 8px 16px;
            font-size: 14px;
            width: auto;
        }

        .btn-secondary {
            background: #6c757d;
        }

        .btn-success {
            background: #28a745;
        }

        .btn-danger {
            background: #dc3545;
        }

        .btn-warning {
            background: #ffc107;
            color: #333;
        }

        .btn-info {
            background: #17a2b8;
        }

        /* App View Styles */
        #appView {
            min-height: 100vh;
        }

        .navbar {
            background: white;
            padding: 15px 0;
            border-radius: 20px;
            margin-bottom: 20px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
        }

        .navbar-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 30px;
        }

        .welcome-text {
            font-size: 18px;
            font-weight: 600;
            color: #667eea;
        }

        .nav-buttons {
            display: flex;
            gap: 10px;
        }

        .nav-btn {
            background: transparent;
            border: 2px solid #667eea;
            color: #667eea;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .nav-btn:hover, .nav-btn.active {
            background: #667eea;
            color: white;
        }

        .logout-btn {
            background: #dc3545;
            border: none;
            color: white;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
        }

        .logout-btn:hover {
            background: #c82333;
        }

        /* Card Styles */
        .card {
            background: white;
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }

        .card h2 {
            margin-bottom: 20px;
            color: #667eea;
            font-size: 24px;
        }

        .card h3 {
            margin-bottom: 15px;
            color: #667eea;
            font-size: 18px;
        }

        /* Dashboard Styles */
        .check-in-section {
            text-align: center;
            margin-bottom: 30px;
        }

        .status-display {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 15px;
            margin: 20px 0;
            font-size: 18px;
        }

        .check-btn {
            font-size: 24px;
            padding: 20px 40px;
            border-radius: 15px;
            margin: 20px 0;
            min-width: 250px;
            font-weight: bold;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .stats-card {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            padding: 25px;
            border-radius: 15px;
            text-align: center;
            border-left: 5px solid #667eea;
        }

        .stats-card h4 {
            color: #667eea;
            margin-bottom: 10px;
            font-size: 16px;
        }

        .stats-amount {
            font-size: 24px;
            font-weight: bold;
            color: #28a745;
        }

        .progress-bar {
            background: #e9ecef;
            border-radius: 10px;
            height: 20px;
            margin-top: 10px;
            overflow: hidden;
        }

        .progress-fill {
            background: linear-gradient(90deg, #28a745, #20c997);
            height: 100%;
            transition: width 0.3s ease;
        }

        /* Chart Styles */
        .chart-container {
            background: white;
            padding: 20px;
            border-radius: 15px;
            margin: 20px 0;
            height: 300px;
            position: relative;
        }

        .chart-bars {
            display: flex;
            align-items: end;
            height: 200px;
            gap: 5px;
            margin-top: 20px;
        }

        .chart-bar {
            background: linear-gradient(to top, #667eea, #764ba2);
            border-radius: 4px 4px 0 0;
            min-width: 20px;
            position: relative;
            transition: all 0.3s ease;
        }

        .chart-bar:hover {
            opacity: 0.8;
            transform: scale(1.05);
        }

        .chart-bar-label {
            position: absolute;
            bottom: -25px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 12px;
            color: #666;
        }

        /* Form Styles */
        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .form-actions {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
            margin-top: 20px;
        }

        /* Table Styles */
        .table-container {
            overflow-x: auto;
            margin-top: 20px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        table {
            width: 100%;
            border-collapse: collapse;
            background: white;
        }

        th, td {
            padding: 15px 12px;
            text-align: left;
            border-bottom: 1px solid #e1e5e9;
        }

        th {
            background: #667eea;
            color: white;
            font-weight: 600;
            position: sticky;
            top: 0;
        }

        tr:nth-child(even) {
            background: #f8f9fa;
        }

        tr:hover {
            background: #e3f2fd;
        }

        .total-row {
            background: #e8f4f8 !important;
            font-weight: bold;
        }

        .total-row td {
            border-top: 3px solid #667eea;
        }

        .edit-btn, .delete-btn {
            padding: 5px 10px;
            margin: 0 2px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
        }

        .edit-btn {
            background: #ffc107;
            color: #333;
        }

        .delete-btn {
            background: #dc3545;
            color: white;
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
        }

        .modal-content {
            background-color: white;
            margin: 5% auto;
            padding: 30px;
            border-radius: 20px;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.3);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .close {
            color: #aaa;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }

        .close:hover {
            color: #000;
        }

        /* Report Controls */
        .report-controls {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            align-items: end;
            flex-wrap: wrap;
        }

        .report-controls .form-group {
            margin-bottom: 0;
            min-width: 120px;
        }

        /* Export Buttons */
        .export-buttons {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        /* Settings */
        .settings-section {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 20px;
            border-left: 5px solid #667eea;
        }

        .current-wage {
            font-size: 20px;
            margin-bottom: 20px;
            color: #667eea;
            font-weight: bold;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }

            .navbar {
                border-radius: 15px;
                margin-bottom: 15px;
            }

            .navbar-content {
                flex-direction: column;
                gap: 15px;
                padding: 0 15px;
            }

            .welcome-text {
                font-size: 16px;
                text-align: center;
            }

            .nav-buttons {
                display: grid;
                grid-template-columns: 1fr 1fr 1fr;
                gap: 8px;
                width: 100%;
            }

            .nav-btn {
                padding: 10px 8px;
                font-size: 14px;
                text-align: center;
            }

            .theme-toggle, .logout-btn {
                grid-column: span 1;
                padding: 10px 8px;
                font-size: 14px;
            }

            .card {
                padding: 20px 15px;
                border-radius: 15px;
                margin-bottom: 15px;
            }

            .card h2 {
                font-size: 20px;
                text-align: center;
            }

            .card h3 {
                font-size: 16px;
            }

            .check-btn {
                width: 100%;
                min-width: auto;
                font-size: 18px;
                padding: 18px 20px;
            }

            .stats-grid {
                grid-template-columns: 1fr;
                gap: 15px;
            }

            .stats-card {
                padding: 20px 15px;
            }

            .form-row {
                grid-template-columns: 1fr;
                gap: 15px;
            }

            .report-controls {
                flex-direction: column;
                align-items: stretch;
                gap: 15px;
            }

            .export-buttons {
                display: grid;
                grid-template-columns: 1fr 1fr;
                gap: 10px;
            }

            .form-actions {
                display: grid;
                grid-template-columns: 1fr 1fr;
                gap: 10px;
            }

            .modal-content {
                margin: 10% auto;
                width: 95%;
                padding: 20px;
            }

            .login-card {
                margin: 20px;
                padding: 30px 20px;
            }

            .login-card h1 {
                font-size: 24px;
            }

            /* Toast responsive */
            .toast {
                right: 10px;
                left: 10px;
                min-width: auto;
                max-width: none;
                transform: translateY(-100px);
            }

            .toast.show {
                transform: translateY(0);
            }

            /* Table responsive */
            .table-container {
                font-size: 14px;
            }

            th, td {
                padding: 10px 8px;
            }

            .edit-btn, .delete-btn {
                padding: 4px 8px;
                font-size: 11px;
            }

            /* Chart responsive */
            .chart-container {
                height: 250px;
            }

            .chart-bars {
                height: 150px;
            }
        }

        @media (max-width: 480px) {
            .nav-buttons {
                grid-template-columns: 1fr;
                gap: 8px;
            }

            .export-buttons {
                grid-template-columns: 1fr;
            }

            .form-actions {
                grid-template-columns: 1fr;
            }

            .stats-card h4 {
                font-size: 14px;
            }

            .stats-amount {
                font-size: 20px;
            }

            .card h2 {
                font-size: 18px;
            }

            .check-btn {
                font-size: 16px;
                padding: 16px 20px;
            }
        }

        .hidden {
            display: none !important;
        }

        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }

        .status-in {
            background: #28a745;
        }

        .status-out {
            background: #dc3545;
        }

        /* Dark mode toggle */
        .theme-toggle {
            background: #6c757d;
            border: none;
            color: white;
            padding: 8px 12px;
            border-radius: 6px;
            cursor: pointer;
            margin-left: 10px;
        }

        /* Dark mode styles */
        body.dark-mode {
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            color: #ecf0f1;
        }

        body.dark-mode .card,
        body.dark-mode .navbar,
        body.dark-mode .login-card,
        body.dark-mode .modal-content {
            background: #34495e;
            color: #ecf0f1;
        }

        body.dark-mode input,
        body.dark-mode select,
        body.dark-mode textarea {
            background: #2c3e50;
            color: #ecf0f1;
            border-color: #4a5f7a;
        }

        body.dark-mode .stats-card {
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
        }

        body.dark-mode th {
            background: #2c3e50;
        }

        body.dark-mode tr:nth-child(even) {
            background: #2c3e50;
        }

        body.dark-mode tr:hover {
            background: #4a5f7a;
        }
    </style>
</head>
<body>
    <!-- Toast Notification -->
    <div id="toast" class="toast">
        <div class="toast-icon" id="toastIcon">‚úÖ</div>
        <div class="toast-content" id="toastContent">Th√¥ng b√°o</div>
        <button class="toast-close" id="toastClose" onclick="hideToast()">‚úï</button>
    </div>

    <!-- Login View -->
    <div id="loginView">
        <div class="login-card">
            <h1>üïê ·ª®ng D·ª•ng Ch·∫•m C√¥ng Pro</h1>
            <form id="loginForm">
                <div class="form-group">
                    <label for="username">T√™n ƒëƒÉng nh·∫≠p:</label>
                    <input type="text" id="username" required placeholder="Nh·∫≠p t√™n ƒëƒÉng nh·∫≠p">
                </div>
                <div class="form-group">
                    <label for="password">M·∫≠t kh·∫©u:</label>
                    <input type="password" id="password" required placeholder="Nh·∫≠p m·∫≠t kh·∫©u">
                </div>
                <button type="submit" class="btn">ƒêƒÉng Nh·∫≠p / ƒêƒÉng K√Ω</button>
            </form>
        </div>
    </div>

    <!-- App View -->
    <div id="appView" class="hidden">
        <div class="container">
            <!-- Navbar -->
            <div class="navbar">
                <div class="navbar-content">
                    <div class="welcome-text" id="welcomeText">Xin ch√†o!</div>
                    <div class="nav-buttons">
                        <button class="nav-btn active" onclick="showTab('dashboardTab')">üìä Dashboard</button>
                        <button class="nav-btn" onclick="showTab('reportTab')">üìà B√°o C√°o</button>
                        <button class="nav-btn" onclick="showTab('settingsTab')">‚öôÔ∏è C√†i ƒê·∫∑t</button>
                        <button class="theme-toggle" onclick="toggleTheme()">üåô</button>
                        <button class="logout-btn" onclick="logout()">ƒêƒÉng Xu·∫•t</button>
                    </div>
                </div>
            </div>

            <!-- Dashboard Tab -->
            <div id="dashboardTab" class="card">
                <div class="check-in-section">
                    <h2>üïê Tr·∫°ng th√°i ch·∫•m c√¥ng</h2>
                    <div class="status-display" id="currentStatus">
                        <span class="status-indicator status-out"></span>
                        <span>Ch∆∞a check-in</span>
                    </div>
                    <button id="checkButton" class="btn check-btn btn-success" onclick="handleCheckInOut()">
                        CHECK-IN
                    </button>
                </div>

                <!-- Statistics Grid -->
                <div class="stats-grid">
                    <div class="stats-card">
                        <h4>üìÖ H√¥m nay</h4>
                        <div class="stats-amount" id="todayHours">0 gi·ªù</div>
                        <div class="stats-amount" id="todayEarnings">0 VNƒê</div>
                    </div>
                    <div class="stats-card">
                        <h4>üìä Tu·∫ßn n√†y</h4>
                        <div class="stats-amount" id="weekHours">0 gi·ªù</div>
                        <div class="stats-amount" id="weekEarnings">0 VNƒê</div>
                    </div>
                    <div class="stats-card">
                        <h4>üìà Th√°ng n√†y</h4>
                        <div class="stats-amount" id="monthHours">0 gi·ªù</div>
                        <div class="stats-amount" id="monthEarnings">0 VNƒê</div>
                    </div>
                    <div class="stats-card">
                        <h4>üéØ M·ª•c ti√™u th√°ng</h4>
                        <div class="stats-amount" id="goalProgress">0%</div>
                        <div class="progress-bar">
                            <div class="progress-fill" id="progressFill" style="width: 0%"></div>
                        </div>
                    </div>
                </div>

                <!-- Weekly Chart -->
                <div class="card">
                    <h3>üìä Bi·ªÉu ƒë·ªì gi·ªù l√†m 7 ng√†y g·∫ßn nh·∫•t</h3>
                    <div class="chart-container">
                        <div class="chart-bars" id="weeklyChart"></div>
                    </div>
                </div>

                <!-- Manual Entry -->
                <div class="card">
                    <h3>‚ûï Th√™m ca l√†m th·ªß c√¥ng</h3>
                    <form id="manualEntryForm">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="manualDate">Ng√†y:</label>
                                <input type="date" id="manualDate" required>
                            </div>
                            <div class="form-group">
                                <label for="manualStartTime">Gi·ªù b·∫Øt ƒë·∫ßu:</label>
                                <input type="time" id="manualStartTime" required>
                            </div>
                            <div class="form-group">
                                <label for="manualEndTime">Gi·ªù k·∫øt th√∫c:</label>
                                <input type="time" id="manualEndTime" required>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="manualNote">Ghi ch√∫ (t√πy ch·ªçn):</label>
                            <textarea id="manualNote" placeholder="M√¥ t·∫£ c√¥ng vi·ªác ƒë√£ l√†m..."></textarea>
                        </div>
                        <button type="submit" class="btn">Th√™m ca l√†m</button>
                    </form>
                </div>
            </div>

            <!-- Report Tab -->
            <div id="reportTab" class="card hidden">
                <h2>üìà B√°o c√°o l∆∞∆°ng</h2>
                
                <div class="report-controls">
                    <div class="form-group">
                        <label for="reportMonth">Th√°ng:</label>
                        <select id="reportMonth">
                            <option value="1">Th√°ng 1</option>
                            <option value="2">Th√°ng 2</option>
                            <option value="3">Th√°ng 3</option>
                            <option value="4">Th√°ng 4</option>
                            <option value="5">Th√°ng 5</option>
                            <option value="6">Th√°ng 6</option>
                            <option value="7">Th√°ng 7</option>
                            <option value="8">Th√°ng 8</option>
                            <option value="9">Th√°ng 9</option>
                            <option value="10">Th√°ng 10</option>
                            <option value="11">Th√°ng 11</option>
                            <option value="12">Th√°ng 12</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="reportYear">NƒÉm:</label>
                        <select id="reportYear"></select>
                    </div>
                    <button class="btn btn-small" onclick="generateReport()">Xem b√°o c√°o</button>
                </div>

                <div class="export-buttons">
                    <button class="btn btn-small btn-success" onclick="exportToCSV()">üìä Xu·∫•t CSV</button>
                    <button class="btn btn-small btn-info" onclick="exportToJSON()">üíæ Backup JSON</button>
                    <button class="btn btn-small btn-warning" onclick="document.getElementById('importFile').click()">üìÅ Kh√¥i ph·ª•c</button>
                    <input type="file" id="importFile" accept=".json" style="display: none;" onchange="importFromJSON(event)">
                </div>

                <div class="table-container">
                    <table id="reportTable">
                        <thead>
                            <tr>
                                <th>üìÖ Ng√†y</th>
                                <th>üïê Check-in</th>
                                <th>üïï Check-out</th>
                                <th>‚è∞ S·ªë gi·ªù l√†m</th>
                                <th>üí∞ L∆∞∆°ng (VNƒê)</th>
                                <th>üìù Ghi ch√∫</th>
                                <th>üîß Thao t√°c</th>
                            </tr>
                        </thead>
                        <tbody id="reportTableBody">
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Settings Tab -->
            <div id="settingsTab" class="card hidden">
                <h2>‚öôÔ∏è C√†i ƒë·∫∑t</h2>
                
                <div class="settings-section">
                    <h3>üí∞ C√†i ƒë·∫∑t l∆∞∆°ng</h3>
                    <div class="current-wage" id="currentWageDisplay">
                        M·ª©c l∆∞∆°ng hi·ªán t·∫°i: 25,000 VNƒê/gi·ªù
                    </div>
                    <form id="wageForm">
                        <div class="form-group">
                            <label for="newWage">M·ª©c l∆∞∆°ng m·ªõi theo gi·ªù (VNƒê):</label>
                            <input type="number" id="newWage" min="1000" step="1000" required placeholder="Nh·∫≠p m·ª©c l∆∞∆°ng m·ªõi theo gi·ªù">
                        </div>
                        <button type="submit" class="btn">L∆∞u thay ƒë·ªïi</button>
                    </form>
                </div>

                <div class="settings-section">
                    <h3>üéØ M·ª•c ti√™u l√†m vi·ªác</h3>
                    <form id="goalForm">
                        <div class="form-group">
                            <label for="monthlyGoal">M·ª•c ti√™u gi·ªù l√†m/th√°ng:</label>
                            <input type="number" id="monthlyGoal" min="1" max="744" required placeholder="V√≠ d·ª•: 160">
                        </div>
                        <button type="submit" class="btn">L∆∞u m·ª•c ti√™u</button>
                    </form>
                </div>

                <div class="settings-section">
                    <h3>üîî C√†i ƒë·∫∑t nh·∫Øc nh·ªü</h3>
                    <form id="reminderForm">
                        <div class="form-group">
                            <label>
                                <input type="checkbox" id="enableReminders"> B·∫≠t nh·∫Øc nh·ªü check-in/out
                            </label>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="reminderCheckIn">Nh·∫Øc check-in l√∫c:</label>
                                <input type="time" id="reminderCheckIn" value="09:00">
                            </div>
                            <div class="form-group">
                                <label for="reminderCheckOut">Nh·∫Øc check-out l√∫c:</label>
                                <input type="time" id="reminderCheckOut" value="17:00">
                            </div>
                        </div>
                        <button type="submit" class="btn">L∆∞u c√†i ƒë·∫∑t</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Edit Modal -->
    <div id="editModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>‚úèÔ∏è Ch·ªânh s·ª≠a ca l√†m</h3>
                <span class="close" onclick="closeEditModal()">&times;</span>
            </div>
            <form id="editForm">
                <input type="hidden" id="editLogId">
                <div class="form-row">
                    <div class="form-group">
                        <label for="editDate">Ng√†y:</label>
                        <input type="date" id="editDate" required>
                    </div>
                    <div class="form-group">
                        <label for="editStartTime">Gi·ªù b·∫Øt ƒë·∫ßu:</label>
                        <input type="time" id="editStartTime" required>
                    </div>
                    <div class="form-group">
                        <label for="editEndTime">Gi·ªù k·∫øt th√∫c:</label>
                        <input type="time" id="editEndTime" required>
                    </div>
                </div>
                <div class="form-group">
                    <label for="editNote">Ghi ch√∫:</label>
                    <textarea id="editNote" placeholder="M√¥ t·∫£ c√¥ng vi·ªác ƒë√£ l√†m..."></textarea>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeEditModal()">H·ªßy</button>
                    <button type="submit" class="btn">L∆∞u thay ƒë·ªïi</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Check-out Note Modal -->
    <div id="checkoutModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>üìù Ghi ch√∫ ca l√†m</h3>
                <span class="close" onclick="closeCheckoutModal()">&times;</span>
            </div>
            <form id="checkoutForm">
                <div class="form-group">
                    <label for="checkoutNote">M√¥ t·∫£ c√¥ng vi·ªác h√¥m nay:</label>
                    <textarea id="checkoutNote" placeholder="B·∫°n ƒë√£ ho√†n th√†nh nh·ªØng g√¨ h√¥m nay?"></textarea>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeCheckoutModal()">B·ªè qua</button>
                    <button type="submit" class="btn">Ho√†n th√†nh check-out</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // Global variables
        let appData = {
            currentUser: null,
            users: {}
        };

        let currentCheckIn = null;
        let reminderInterval = null;

        // Data management functions
        function loadData() {
            const stored = localStorage.getItem('chamCongApp');
            if (stored) {
                appData = JSON.parse(stored);
            } else {
                appData = {
                    currentUser: null,
                    users: {}
                };
            }
        }

        function saveData() {
            localStorage.setItem('chamCongApp', JSON.stringify(appData));
        }

        // Toast notification system
        let toastTimeout;

        function showToast(message, type = 'success') {
            const toast = document.getElementById('toast');
            const toastIcon = document.getElementById('toastIcon');
            const toastContent = document.getElementById('toastContent');
            
            // Clear existing timeout
            if (toastTimeout) {
                clearTimeout(toastTimeout);
            }
            
            // Set icon based on type
            const icons = {
                success: '‚úÖ',
                error: '‚ùå',
                warning: '‚ö†Ô∏è'
            };
            
            toastIcon.textContent = icons[type] || icons.success;
            toastContent.textContent = message;
            
            // Set classes
            toast.className = `toast ${type}`;
            toast.classList.add('show');
            
            // Auto hide after 4 seconds
            toastTimeout = setTimeout(() => {
                hideToast();
            }, 4000);
        }

        function hideToast() {
            const toast = document.getElementById('toast');
            toast.classList.remove('show');
            
            if (toastTimeout) {
                clearTimeout(toastTimeout);
                toastTimeout = null;
            }
        }

        // Theme management
        function toggleTheme() {
            document.body.classList.toggle('dark-mode');
            const isDark = document.body.classList.contains('dark-mode');
            localStorage.setItem('darkMode', isDark);
            
            const themeBtn = document.querySelector('.theme-toggle');
            themeBtn.textContent = isDark ? '‚òÄÔ∏è' : 'üåô';
        }

        function loadTheme() {
            const isDark = localStorage.getItem('darkMode') === 'true';
            if (isDark) {
                document.body.classList.add('dark-mode');
                document.querySelector('.theme-toggle').textContent = '‚òÄÔ∏è';
            }
        }

        // UI management functions
        function showView(viewId) {
            document.getElementById('loginView').classList.add('hidden');
            document.getElementById('appView').classList.add('hidden');
            document.getElementById(viewId).classList.remove('hidden');
        }

        function showTab(tabId) {
            // Hide all tabs
            document.getElementById('dashboardTab').classList.add('hidden');
            document.getElementById('reportTab').classList.add('hidden');
            document.getElementById('settingsTab').classList.add('hidden');
            
            // Show selected tab
            document.getElementById(tabId).classList.remove('hidden');
            
            // Update nav buttons
            document.querySelectorAll('.nav-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            // Update content based on tab
            if (tabId === 'reportTab') {
                initializeReportTab();
            } else if (tabId === 'dashboardTab') {
                updateWeeklyChart();
            }
        }

        function updateUI() {
            if (!appData.currentUser) return;
            
            const user = appData.users[appData.currentUser];
            
            // Update welcome text
            document.getElementById('welcomeText').textContent = `Xin ch√†o, ${appData.currentUser}!`;
            
            // Update check-in status
            updateCheckInStatus();
            
            // Update all statistics
            updateStatistics();
            
            // Update current wage display
            document.getElementById('currentWageDisplay').textContent = 
                `M·ª©c l∆∞∆°ng hi·ªán t·∫°i: ${formatCurrency(user.hourlyWage)}/gi·ªù`;
            
            // Set today's date for manual entry
            document.getElementById('manualDate').valueAsDate = new Date();
            
            // Load user settings
            loadUserSettings();
            
            // Update weekly chart
            updateWeeklyChart();
        }

        function updateCheckInStatus() {
            const user = appData.users[appData.currentUser];
            const statusElement = document.getElementById('currentStatus');
            const checkButton = document.getElementById('checkButton');
            
            // Check if user is currently checked in
            const lastLog = user.timeLogs[user.timeLogs.length - 1];
            const isCheckedIn = lastLog && !lastLog.checkOutTime;
            
            if (isCheckedIn) {
                const checkInTime = new Date(lastLog.checkInTime);
                statusElement.innerHTML = `
                    <span class="status-indicator status-in"></span>
                    <span>‚úÖ ƒêang trong ca l√†m vi·ªác (b·∫Øt ƒë·∫ßu l√∫c ${formatTime(checkInTime)})</span>
                `;
                checkButton.textContent = 'CHECK-OUT';
                checkButton.className = 'btn check-btn btn-danger';
                currentCheckIn = lastLog;
            } else {
                statusElement.innerHTML = '<span class="status-indicator status-out"></span><span>‚ùå Ch∆∞a check-in</span>';
                checkButton.textContent = 'CHECK-IN';
                checkButton.className = 'btn check-btn btn-success';
                currentCheckIn = null;
            }
        }

        function updateStatistics() {
            const user = appData.users[appData.currentUser];
            const now = new Date();
            
            // Today's stats
            const todayStats = calculateDayStats(now);
            document.getElementById('todayHours').textContent = `${todayStats.hours.toFixed(1)} gi·ªù`;
            document.getElementById('todayEarnings').textContent = formatCurrency(todayStats.earnings);
            
            // Week's stats
            const weekStats = calculateWeekStats(now);
            document.getElementById('weekHours').textContent = `${weekStats.hours.toFixed(1)} gi·ªù`;
            document.getElementById('weekEarnings').textContent = formatCurrency(weekStats.earnings);
            
            // Month's stats
            const monthStats = calculateMonthStats(now);
            document.getElementById('monthHours').textContent = `${monthStats.hours.toFixed(1)} gi·ªù`;
            document.getElementById('monthEarnings').textContent = formatCurrency(monthStats.earnings);
            
            // Goal progress
            const monthlyGoal = user.monthlyGoal || 160;
            const progress = Math.min((monthStats.hours / monthlyGoal) * 100, 100);
            document.getElementById('goalProgress').textContent = `${progress.toFixed(1)}%`;
            document.getElementById('progressFill').style.width = `${progress}%`;
        }

        function calculateDayStats(date) {
            const user = appData.users[appData.currentUser];
            let hours = 0;
            let earnings = 0;
            
            const dayStart = new Date(date);
            dayStart.setHours(0, 0, 0, 0);
            const dayEnd = new Date(date);
            dayEnd.setHours(23, 59, 59, 999);
            
            user.timeLogs.forEach(log => {
                if (log.checkOutTime) {
                    const logDate = new Date(log.checkInTime);
                    if (logDate >= dayStart && logDate <= dayEnd) {
                        const checkInTime = new Date(log.checkInTime);
                        const checkOutTime = new Date(log.checkOutTime);
                        const hoursWorked = (checkOutTime - checkInTime) / (1000 * 60 * 60);
                        hours += hoursWorked;
                        earnings += log.earnings || 0;
                    }
                }
            });
            
            return { hours, earnings };
        }

        function calculateWeekStats(date) {
            const user = appData.users[appData.currentUser];
            let hours = 0;
            let earnings = 0;
            
            const weekStart = new Date(date);
            weekStart.setDate(date.getDate() - date.getDay());
            weekStart.setHours(0, 0, 0, 0);
            
            const weekEnd = new Date(weekStart);
            weekEnd.setDate(weekStart.getDate() + 6);
            weekEnd.setHours(23, 59, 59, 999);
            
            user.timeLogs.forEach(log => {
                if (log.checkOutTime) {
                    const logDate = new Date(log.checkInTime);
                    if (logDate >= weekStart && logDate <= weekEnd) {
                        const checkInTime = new Date(log.checkInTime);
                        const checkOutTime = new Date(log.checkOutTime);
                        const hoursWorked = (checkOutTime - checkInTime) / (1000 * 60 * 60);
                        hours += hoursWorked;
                        earnings += log.earnings || 0;
                    }
                }
            });
            
            return { hours, earnings };
        }

        function calculateMonthStats(date) {
            const user = appData.users[appData.currentUser];
            let hours = 0;
            let earnings = 0;
            
            const currentMonth = date.getMonth();
            const currentYear = date.getFullYear();
            
            user.timeLogs.forEach(log => {
                if (log.checkOutTime) {
                    const logDate = new Date(log.checkInTime);
                    if (logDate.getMonth() === currentMonth && logDate.getFullYear() === currentYear) {
                        const checkInTime = new Date(log.checkInTime);
                        const checkOutTime = new Date(log.checkOutTime);
                        const hoursWorked = (checkOutTime - checkInTime) / (1000 * 60 * 60);
                        hours += hoursWorked;
                        earnings += log.earnings || 0;
                    }
                }
            });
            
            return { hours, earnings };
        }

        function updateWeeklyChart() {
            const chartContainer = document.getElementById('weeklyChart');
            chartContainer.innerHTML = '';
            
            const today = new Date();
            const chartData = [];
            
            // Get last 7 days data
            for (let i = 6; i >= 0; i--) {
                const date = new Date(today);
                date.setDate(today.getDate() - i);
                const stats = calculateDayStats(date);
                chartData.push({
                    date: date,
                    hours: stats.hours,
                    label: date.getDate()
                });
            }
            
            const maxHours = Math.max(...chartData.map(d => d.hours), 1);
            
            chartData.forEach(data => {
                const bar = document.createElement('div');
                bar.className = 'chart-bar';
                const height = (data.hours / maxHours) * 200;
                bar.style.height = `${height}px`;
                bar.title = `${data.date.toLocaleDateString('vi-VN')}: ${data.hours.toFixed(1)} gi·ªù`;
                
                const label = document.createElement('div');
                label.className = 'chart-bar-label';
                label.textContent = data.label;
                bar.appendChild(label);
                
                chartContainer.appendChild(bar);
            });
        }

        // Authentication functions
        function handleLoginRegister() {
            const username = document.getElementById('username').value.trim();
            const password = document.getElementById('password').value;
            
            if (!username || !password) {
                showToast('Vui l√≤ng nh·∫≠p ƒë·∫ßy ƒë·ªß th√¥ng tin!', 'error');
                return;
            }
            
            // Check if user exists
            if (appData.users[username]) {
                // Login
                if (appData.users[username].password === password) {
                    appData.currentUser = username;
                    saveData();
                    showView('appView');
                    updateUI();
                    showToast(`Ch√†o m·ª´ng tr·ªü l·∫°i, ${username}!`);
                    startReminderService();
                } else {
                    showToast('M·∫≠t kh·∫©u kh√¥ng ƒë√∫ng!', 'error');
                }
            } else {
                // Register
                appData.users[username] = {
                    password: password,
                    hourlyWage: 25000,
                    monthlyGoal: 160,
                    timeLogs: [],
                    settings: {
                        reminders: false,
                        checkInTime: '09:00',
                        checkOutTime: '17:00'
                    }
                };
                appData.currentUser = username;
                saveData();
                showView('appView');
                updateUI();
                showToast('T√†i kho·∫£n ƒë√£ ƒë∆∞·ª£c t·∫°o th√†nh c√¥ng!');
                startReminderService();
            }
        }

        function logout() {
            stopReminderService();
            appData.currentUser = null;
            saveData();
            document.getElementById('username').value = '';
            document.getElementById('password').value = '';
            showView('loginView');
            showToast('ƒê√£ ƒëƒÉng xu·∫•t th√†nh c√¥ng!');
        }

        // Time tracking functions
        function handleCheckInOut() {
            const user = appData.users[appData.currentUser];
            const now = new Date();
            
            if (currentCheckIn) {
                // Show checkout modal for note
                document.getElementById('checkoutModal').style.display = 'block';
            } else {
                // Check in
                checkIn();
            }
        }

        function checkIn() {
            const user = appData.users[appData.currentUser];
            const now = new Date();
            
            const newLog = {
                id: Date.now().toString(),
                checkInTime: now.toISOString(),
                checkOutTime: null,
                earnings: 0,
                note: ''
            };
            
            user.timeLogs.push(newLog);
            saveData();
            updateUI();
            
            showToast('Check-in th√†nh c√¥ng!');
        }

        function checkOut(note = '') {
            const user = appData.users[appData.currentUser];
            const now = new Date();
            
            currentCheckIn.checkOutTime = now.toISOString();
            currentCheckIn.note = note;
            
            // Calculate earnings
            const checkInTime = new Date(currentCheckIn.checkInTime);
            const checkOutTime = new Date(currentCheckIn.checkOutTime);
            const hoursWorked = (checkOutTime - checkInTime) / (1000 * 60 * 60);
            currentCheckIn.earnings = Math.round(hoursWorked * user.hourlyWage);
            
            saveData();
            updateUI();
            
            showToast(`Check-out th√†nh c√¥ng! S·ªë gi·ªù l√†m: ${hoursWorked.toFixed(2)} gi·ªù, L∆∞∆°ng: ${formatCurrency(currentCheckIn.earnings)}`);
        }

        function handleManualEntry() {
            const date = document.getElementById('manualDate').value;
            const startTime = document.getElementById('manualStartTime').value;
            const endTime = document.getElementById('manualEndTime').value;
            const note = document.getElementById('manualNote').value;
            
            if (!date || !startTime || !endTime) {
                showToast('Vui l√≤ng nh·∫≠p ƒë·∫ßy ƒë·ªß th√¥ng tin!', 'error');
                return;
            }
            
            const startDateTime = new Date(`${date}T${startTime}`);
            const endDateTime = new Date(`${date}T${endTime}`);
            
            if (endDateTime <= startDateTime) {
                showToast('Gi·ªù k·∫øt th√∫c ph·∫£i sau gi·ªù b·∫Øt ƒë·∫ßu!', 'error');
                return;
            }
            
            const user = appData.users[appData.currentUser];
            const hoursWorked = (endDateTime - startDateTime) / (1000 * 60 * 60);
            const earnings = Math.round(hoursWorked * user.hourlyWage);
            
            const newLog = {
                id: Date.now().toString(),
                checkInTime: startDateTime.toISOString(),
                checkOutTime: endDateTime.toISOString(),
                earnings: earnings,
                note: note
            };
            
            user.timeLogs.push(newLog);
            
            // Sort logs by date
            user.timeLogs.sort((a, b) => new Date(a.checkInTime) - new Date(b.checkInTime));
            
            saveData();
            updateUI();
            
            // Reset form
            document.getElementById('manualEntryForm').reset();
            document.getElementById('manualDate').valueAsDate = new Date();
            
            showToast(`Ca l√†m ƒë√£ ƒë∆∞·ª£c th√™m! S·ªë gi·ªù: ${hoursWorked.toFixed(2)}, L∆∞∆°ng: ${formatCurrency(earnings)}`);
        }

        // Report functions
        function initializeReportTab() {
            const yearSelect = document.getElementById('reportYear');
            const currentYear = new Date().getFullYear();
            
            // Clear existing options
            yearSelect.innerHTML = '';
            
            // Add years (current year and 2 years back)
            for (let year = currentYear; year >= currentYear - 2; year--) {
                const option = document.createElement('option');
                option.value = year;
                option.textContent = year;
                if (year === currentYear) option.selected = true;
                yearSelect.appendChild(option);
            }
            
            // Set current month
            document.getElementById('reportMonth').value = new Date().getMonth() + 1;
            
            // Generate initial report
            generateReport();
        }

        function generateReport() {
            const month = parseInt(document.getElementById('reportMonth').value);
            const year = parseInt(document.getElementById('reportYear').value);
            const user = appData.users[appData.currentUser];
            
            const filteredLogs = user.timeLogs.filter(log => {
                if (!log.checkOutTime) return false;
                const logDate = new Date(log.checkInTime);
                return logDate.getMonth() + 1 === month && logDate.getFullYear() === year;
            });
            
            const tbody = document.getElementById('reportTableBody');
            tbody.innerHTML = '';
            
            let totalHours = 0;
            let totalEarnings = 0;
            
            filteredLogs.forEach(log => {
                const checkInTime = new Date(log.checkInTime);
                const checkOutTime = new Date(log.checkOutTime);
                const hoursWorked = (checkOutTime - checkInTime) / (1000 * 60 * 60);
                
                totalHours += hoursWorked;
                totalEarnings += log.earnings;
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${formatDate(checkInTime)}</td>
                    <td>${formatTime(checkInTime)}</td>
                    <td>${formatTime(checkOutTime)}</td>
                    <td>${hoursWorked.toFixed(2)} gi·ªù</td>
                    <td>${formatCurrency(log.earnings)}</td>
                    <td>${log.note || '-'}</td>
                    <td>
                        <button class="edit-btn" onclick="openEditModal('${log.id}')">‚úèÔ∏è</button>
                        <button class="delete-btn" onclick="deleteLog('${log.id}')">üóëÔ∏è</button>
                    </td>
                `;
                tbody.appendChild(row);
            });
            
            // Add total row
            const totalRow = document.createElement('tr');
            totalRow.className = 'total-row';
            totalRow.innerHTML = `
                <td colspan="3"><strong>T·ªïng c·ªông:</strong></td>
                <td><strong>${totalHours.toFixed(2)} gi·ªù</strong></td>
                <td><strong>${formatCurrency(totalEarnings)}</strong></td>
                <td colspan="2"></td>
            `;
            tbody.appendChild(totalRow);
        }

        // Edit/Delete functions
        function openEditModal(logId) {
            const user = appData.users[appData.currentUser];
            const log = user.timeLogs.find(l => l.id === logId);
            
            if (!log) return;
            
            const checkInTime = new Date(log.checkInTime);
            const checkOutTime = new Date(log.checkOutTime);
            
            document.getElementById('editLogId').value = logId;
            document.getElementById('editDate').value = checkInTime.toISOString().split('T')[0];
            document.getElementById('editStartTime').value = checkInTime.toTimeString().slice(0, 5);
            document.getElementById('editEndTime').value = checkOutTime.toTimeString().slice(0, 5);
            document.getElementById('editNote').value = log.note || '';
            
            document.getElementById('editModal').style.display = 'block';
        }

        function closeEditModal() {
            document.getElementById('editModal').style.display = 'none';
        }

        function handleEditLog() {
            const logId = document.getElementById('editLogId').value;
            const date = document.getElementById('editDate').value;
            const startTime = document.getElementById('editStartTime').value;
            const endTime = document.getElementById('editEndTime').value;
            const note = document.getElementById('editNote').value;
            
            if (!date || !startTime || !endTime) {
                showToast('Vui l√≤ng nh·∫≠p ƒë·∫ßy ƒë·ªß th√¥ng tin!', 'error');
                return;
            }
            
            const startDateTime = new Date(`${date}T${startTime}`);
            const endDateTime = new Date(`${date}T${endTime}`);
            
            if (endDateTime <= startDateTime) {
                showToast('Gi·ªù k·∫øt th√∫c ph·∫£i sau gi·ªù b·∫Øt ƒë·∫ßu!', 'error');
                return;
            }
            
            const user = appData.users[appData.currentUser];
            const log = user.timeLogs.find(l => l.id === logId);
            
            if (!log) return;
            
            // Update log
            log.checkInTime = startDateTime.toISOString();
            log.checkOutTime = endDateTime.toISOString();
            log.note = note;
            
            // Recalculate earnings
            const hoursWorked = (endDateTime - startDateTime) / (1000 * 60 * 60);
            log.earnings = Math.round(hoursWorked * user.hourlyWage);
            
            // Sort logs by date
            user.timeLogs.sort((a, b) => new Date(a.checkInTime) - new Date(b.checkInTime));
            
            saveData();
            updateUI();
            generateReport();
            closeEditModal();
            
            showToast('Ca l√†m ƒë√£ ƒë∆∞·ª£c c·∫≠p nh·∫≠t!');
        }

        function deleteLog(logId) {
            if (!confirm('B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a ca l√†m n√†y?')) return;
            
            const user = appData.users[appData.currentUser];
            user.timeLogs = user.timeLogs.filter(log => log.id !== logId);
            
            saveData();
            updateUI();
            generateReport();
            
            showToast('Ca l√†m ƒë√£ ƒë∆∞·ª£c x√≥a!');
        }

        // Checkout modal functions
        function closeCheckoutModal() {
            document.getElementById('checkoutModal').style.display = 'none';
        }

        function handleCheckoutWithNote() {
            const note = document.getElementById('checkoutNote').value;
            checkOut(note);
            closeCheckoutModal();
            document.getElementById('checkoutNote').value = '';
        }

        // Export/Import functions
        function exportToCSV() {
            const month = parseInt(document.getElementById('reportMonth').value);
            const year = parseInt(document.getElementById('reportYear').value);
            const user = appData.users[appData.currentUser];
            
            const filteredLogs = user.timeLogs.filter(log => {
                if (!log.checkOutTime) return false;
                const logDate = new Date(log.checkInTime);
                return logDate.getMonth() + 1 === month && logDate.getFullYear() === year;
            });
            
            let csv = 'Ng√†y,Check-in,Check-out,S·ªë gi·ªù l√†m,L∆∞∆°ng (VNƒê),Ghi ch√∫\n';
            
            filteredLogs.forEach(log => {
                const checkInTime = new Date(log.checkInTime);
                const checkOutTime = new Date(log.checkOutTime);
                const hoursWorked = (checkOutTime - checkInTime) / (1000 * 60 * 60);
                
                csv += `${formatDate(checkInTime)},${formatTime(checkInTime)},${formatTime(checkOutTime)},${hoursWorked.toFixed(2)},${log.earnings},"${log.note || ''}"\n`;
            });
            
            const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `bao-cao-luong-${month}-${year}.csv`;
            link.click();
            
            showToast('ƒê√£ xu·∫•t b√°o c√°o CSV!');
        }

        function exportToJSON() {
            const dataStr = JSON.stringify(appData, null, 2);
            const blob = new Blob([dataStr], { type: 'application/json' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `backup-cham-cong-${new Date().toISOString().split('T')[0]}.json`;
            link.click();
            
            showToast('ƒê√£ t·∫°o file backup!');
        }

        function importFromJSON(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const importedData = JSON.parse(e.target.result);
                    
                    if (confirm('B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën kh√¥i ph·ª•c d·ªØ li·ªáu? D·ªØ li·ªáu hi·ªán t·∫°i s·∫Ω b·ªã ghi ƒë√®!')) {
                        appData = importedData;
                        saveData();
                        updateUI();
                        showToast('ƒê√£ kh√¥i ph·ª•c d·ªØ li·ªáu th√†nh c√¥ng!');
                    }
                } catch (error) {
                    showToast('File kh√¥ng h·ª£p l·ªá!', 'error');
                }
            };
            reader.readAsText(file);
            
            // Reset input
            event.target.value = '';
        }

        // Settings functions
        function handleWageUpdate() {
            const newWage = parseInt(document.getElementById('newWage').value);
            
            if (!newWage || newWage < 1000) {
                showToast('Vui l√≤ng nh·∫≠p m·ª©c l∆∞∆°ng h·ª£p l·ªá (t·ªëi thi·ªÉu 1,000 VNƒê)!', 'error');
                return;
            }
            
            const user = appData.users[appData.currentUser];
            user.hourlyWage = newWage;
            
            saveData();
            updateUI();
            
            document.getElementById('newWage').value = '';
            showToast('M·ª©c l∆∞∆°ng ƒë√£ ƒë∆∞·ª£c c·∫≠p nh·∫≠t th√†nh c√¥ng!');
        }

        function handleGoalUpdate() {
            const newGoal = parseInt(document.getElementById('monthlyGoal').value);
            
            if (!newGoal || newGoal < 1 || newGoal > 744) {
                showToast('Vui l√≤ng nh·∫≠p m·ª•c ti√™u h·ª£p l·ªá (1-744 gi·ªù)!', 'error');
                return;
            }
            
            const user = appData.users[appData.currentUser];
            user.monthlyGoal = newGoal;
            
            saveData();
            updateUI();
            
            showToast('M·ª•c ti√™u ƒë√£ ƒë∆∞·ª£c c·∫≠p nh·∫≠t!');
        }

        function handleReminderSettings() {
            const user = appData.users[appData.currentUser];
            const enabled = document.getElementById('enableReminders').checked;
            const checkInTime = document.getElementById('reminderCheckIn').value;
            const checkOutTime = document.getElementById('reminderCheckOut').value;
            
            user.settings = user.settings || {};
            user.settings.reminders = enabled;
            user.settings.checkInTime = checkInTime;
            user.settings.checkOutTime = checkOutTime;
            
            saveData();
            
            if (enabled) {
                startReminderService();
                showToast('ƒê√£ b·∫≠t nh·∫Øc nh·ªü!');
            } else {
                stopReminderService();
                showToast('ƒê√£ t·∫Øt nh·∫Øc nh·ªü!');
            }
        }

        function loadUserSettings() {
            const user = appData.users[appData.currentUser];
            
            if (user.monthlyGoal) {
                document.getElementById('monthlyGoal').value = user.monthlyGoal;
            }
            
            if (user.settings) {
                document.getElementById('enableReminders').checked = user.settings.reminders || false;
                document.getElementById('reminderCheckIn').value = user.settings.checkInTime || '09:00';
                document.getElementById('reminderCheckOut').value = user.settings.checkOutTime || '17:00';
            }
        }

        // Reminder service
        function startReminderService() {
            stopReminderService(); // Clear existing interval
            
            const user = appData.users[appData.currentUser];
            if (!user.settings || !user.settings.reminders) return;
            
            reminderInterval = setInterval(checkReminders, 60000); // Check every minute
        }

        function stopReminderService() {
            if (reminderInterval) {
                clearInterval(reminderInterval);
                reminderInterval = null;
            }
        }

        function checkReminders() {
            const user = appData.users[appData.currentUser];
            if (!user.settings || !user.settings.reminders) return;
            
            const now = new Date();
            const currentTime = now.toTimeString().slice(0, 5);
            
            const lastLog = user.timeLogs[user.timeLogs.length - 1];
            const isCheckedIn = lastLog && !lastLog.checkOutTime;
            
            // Check-in reminder
            if (currentTime === user.settings.checkInTime && !isCheckedIn) {
                showToast('‚è∞ ƒê√£ ƒë·∫øn gi·ªù check-in!', 'warning');
            }
            
            // Check-out reminder
            if (currentTime === user.settings.checkOutTime && isCheckedIn) {
                showToast('‚è∞ ƒê√£ ƒë·∫øn gi·ªù check-out!', 'warning');
            }
        }

        // Utility functions
        function formatCurrency(amount) {
            return new Intl.NumberFormat('vi-VN').format(amount) + ' VNƒê';
        }

        function formatDate(date) {
            return date.toLocaleDateString('vi-VN');
        }

        function formatTime(date) {
            return date.toLocaleTimeString('vi-VN', { hour: '2-digit', minute: '2-digit' });
        }

        // Event listeners
        document.addEventListener('DOMContentLoaded', function() {
            loadData();
            loadTheme();
            
            // Login form
            document.getElementById('loginForm').addEventListener('submit', function(e) {
                e.preventDefault();
                handleLoginRegister();
            });
            
            // Manual entry form
            document.getElementById('manualEntryForm').addEventListener('submit', function(e) {
                e.preventDefault();
                handleManualEntry();
            });
            
            // Wage form
            document.getElementById('wageForm').addEventListener('submit', function(e) {
                e.preventDefault();
                handleWageUpdate();
            });
            
            // Goal form
            document.getElementById('goalForm').addEventListener('submit', function(e) {
                e.preventDefault();
                handleGoalUpdate();
            });
            
            // Reminder form
            document.getElementById('reminderForm').addEventListener('submit', function(e) {
                e.preventDefault();
                handleReminderSettings();
            });
            
            // Edit form
            document.getElementById('editForm').addEventListener('submit', function(e) {
                e.preventDefault();
                handleEditLog();
            });
            
            // Checkout form
            document.getElementById('checkoutForm').addEventListener('submit', function(e) {
                e.preventDefault();
                handleCheckoutWithNote();
            });
            
            // Close modals when clicking outside
            window.addEventListener('click', function(e) {
                const editModal = document.getElementById('editModal');
                const checkoutModal = document.getElementById('checkoutModal');
                
                if (e.target === editModal) {
                    closeEditModal();
                }
                if (e.target === checkoutModal) {
                    closeCheckoutModal();
                }
            });
            
            // Show appropriate view
            if (appData.currentUser) {
                showView('appView');
                updateUI();
                startReminderService();
            } else {
                showView('loginView');
            }
        });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'983308be42360f2c',t:'MTc1ODU1NzAyNS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
